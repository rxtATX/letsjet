<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
<button type='button' class='eventsBtn'>Click</button>
<div id='myModal'></div>
<script>
var startD;
var endD;
var nameOfCity;

$(document).on("click", ".eventsBtn", runEventsBtn);

function runEventsBtn() {
  startD = $(this).data("Stime");
  startD = moment(startD).format(YYYYMMDD);
  endD = $(this).data("eTime");
  endD = moment(endD).format(YYYYMMDD);
  nameOfCity = $(this).data("value");
  loadModal();
  findEvents();
}

function findEvents() {
   
	var oArgs = {
	  app_key: "WLzwCkPfBxvFrMHm",
	  q: nameOfCity,
	  location: nameOfCity,
	  "date": startD + "00-" + endD + "00",
	  page_size: 6,
	  sort_order: "popularity",
	};

	EVDB.API.call("/events/search", oArgs, function(oData) {
	var response = oData.events;

	function eventsDetails() {
	    for (i = 0; i < oData.events.event.length; i++) {
		    if (response.event[i].description !== null) {
		      $("#modal-content").append("<p>" + response.event[i].title + "</p><p>" + response.event[i].venue_name + "</p><p>" + response.event[i].start_time + "</p><p>" + response.event[i].description + "</p><p>" + response.event[i].venue_url + "</p>")
		    } else {
		      $("#modal-content").append("<p>" + response.event[i].title + "</p><p>" + response.event[i].venue_name + "</p><p>" + response.event[i].start_time + "</p><p>" + response.event[i].venue_url + "</p>")
		    }
	    }
	}
	
	eventsDetails();
	});
}

function loadModal() {
// Get the modal
var modal = $("#myModal");
// Get the button that opens the modal
var btn = $("#eventsBtn");
// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
// When the user clicks on <span> (x), close the modal
$(span).on("click", closeOut);
// When the user clicks anywhere outside of the modal, close it
$(window).on("click", closeOut);
// When the user clicks the button, open the modal 
modal.style.display = "block";

function closeOut() {
  modal.style.display = "none";
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
}
</script>
</body>
</html>